 {{  config (   
     description = "S2P DATA DISCOVERY VIEW OF AP_BATCHES_ALL ",    
     materialized = "view",    
     schema = "PROCUREMENT",    
     tags = ["PROCUREMENT"],   
     alias = "AP_BATCHES_ALL"
     )  
    }} 
SELECT 
BATCH_ID 
, BATCH_NAME
, BATCH_DATE
, LAST_UPDATE_DATE
, LAST_UPDATED_BY
, CONTROL_INVOICE_COUNT
, CONTROL_INVOICE_TOTAL
, ACTUAL_INVOICE_COUNT
, ACTUAL_INVOICE_TOTAL
, INVOICE_CURRENCY_CODE
, PAYMENT_CURRENCY_CODE
, LAST_UPDATE_LOGIN
, CREATION_DATE
, CREATED_BY
, PAY_GROUP_LOOKUP_CODE
, BATCH_CODE_COMBINATION_ID
, TERMS_ID
, ATTRIBUTE_CATEGORY
, ATTRIBUTE1
, ATTRIBUTE2
, ATTRIBUTE3
, ATTRIBUTE4
, ATTRIBUTE5
, ATTRIBUTE6
, ATTRIBUTE7
, ATTRIBUTE8
, ATTRIBUTE9
, ATTRIBUTE10
, ATTRIBUTE11
, ATTRIBUTE12
, ATTRIBUTE13
, ATTRIBUTE14
, ATTRIBUTE15
, INVOICE_TYPE_LOOKUP_CODE
, HOLD_LOOKUP_CODE
, HOLD_REASON
, DOC_CATEGORY_CODE
, ORG_ID
, GL_DATE
, PAYMENT_PRIORITY
, BIW_INS_DTTM
, BIW_UPD_DTTM
, BIW_BATCH_ID
FROM {{source("STG_EBS_AP","AP_BATCHES_ALL")}}     
QUALIFY( ROW_NUMBER() OVER (PARTITION BY BATCH_ID ORDER BY BIW_UPD_DTTM DESC)=1)