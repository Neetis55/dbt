{{
    config(
         description = 'Customer view for Sales Analytics Team'
        ,materialized='view'
        ,schema ='SALES'
        ,tags ='MART_SALES'
        ,alias='CUSTOMER_DIM'
        )
}}
WITH 
MART_CUSTOMER AS (
SELECT
    CUSTOMER_KEY,
    CUSTOMER_CODE, 
    ERP_SITE_USE_ID, 
    ERP_STATUS, 
    CRM_CUSTOMER_OID, 
    CRM_STATUS, 
    CUSTOMER_NAME, 
    CUSTOMER_TYPE_CODE, 
    CUSTOMER_TYPE_DESCRIPTION, 
    CUSTOMER_SOURCE, 
    BUSINESS_CLASS_CODE, 
    CORPORATION_CODE, 
    MD5(CORPORATION_CODE) AS CORPORATION_KEY,
    CORPORATION_DESCRIPTION, 
    END_CORPORATION_CODE, 
    END_CORPORATION_DESCRIPTION, 
    SALES_ORGANIZATION_CODE, 
    MD5(SALES_ORGANIZATION_CODE) AS SALES_TERRITORY_KEY,
    END_USE_CODE, 
    END_USE_DESCRIPTION, 
    CURRENCY_CODE, 
    ISO_CURRENCY_CODE, 
    HAS_CREDIT_HOLD, 
    HAS_SERVICE_HOLD, 
    HAS_APPROVAL, 
    ORDER_PROCESSING_REGION_CODE, 
    CRD_SHIP_EARLY_DAYS_QUANTITY, 
    HAS_CRD_PARTIAL, 
    SHIP_VIA_CODE, 
    HAS_SHIP_TO_CRD, 
    SHIP_LATE_DAYS_QUANTITY, 
    BILL_CUSTOMER_CODE, 
    HANDLING_METHOD_CODE, 
    HANDLING_METHOD_CODE_DESCRIPTION, 
    IS_EDI_CUSTOMER, 
    FINAL_DESTINATION_DESCRIPTION, 
    BILL_COUNTRY_SOURCE_CODE, 
    FOB_OPTION_CODE, 
    PAYMENT_TERM_CODE, 
    FINANCIAL_BANK_ID, 
    TRANSIT_DAYS_QUANTITY, 
    DELIVERY_TYPE_CODE, 
    DATE_CODE_MAXIMUM_AGE_QUANTITY, 
    IS_CPN_REQUIRED, 
    VAT_TAX_CODE, 
    MINIMUM_DOLLAR_VALUE_AMOUNT, 
    IS_MINIMUM_DOLLAR_VALUE_VALID, 
    CORPORATION_CATEGORY_CODE, 
    CORPORATION_CATEGORY_DESCRIPTION, 
    CUSTOMER_ENTITY_CODE, 
    FORECAST_TYPE_CODE, 
    IS_FORECAST_CUSTOMER, 
    FORECAST_CUSTOMER_STATUS_CODE, 
    REPLENISHMENT_CODE, 
    SERVICE_TYPE_CODE, 
    CHANGE_ORDER_APROVAL_REQUIRED_CODE, 
    UDC_GENERIC_PROG_DESCRIPTION, 
    CREATE_BY_ID, 
    CREATE_DTTM, 
    LAST_UPDATE_BY_ID, 
    LAST_UPDATE_DTTM, 
    IS_DELETED, 
    QUALITY_CODE, 
    FISCAL_ACCOUNT_NUMBER, 
    CREDIT_LIMIT_AMOUNT, 
    DIVISION, 
    SALES_STRUCTURE, 
    MARKET_SEGMENT_CODE, 
    IS_ASSEMBLY_LOCATION, 
    OPERATING_UNIT, 
    COF_CODE, 
    COG_CODE, 
    CUSTOMER_SHUT_DOWN_FROM_DATE, 
    CUSTOMER_SHUT_DOWN_TO_DATE, 
    FOB_OPTION_DESCRIPTION, 
    TAX_CODE, 
    ORACLE_ORDER_TYPE, 
    ORACLE_PAYMENT_TERM, 
    ORACLE_SITE_STATUS, 
    ORACLE_SITE_NUMBER, 
    ORACLE_SHIP_METHOD, 
    FREE_TRADE_ZONE, 
    COLLECTOR_NAME, 
    IS_SHUTDOWN, 
    CSR_USER_ID, 
    CSR_FIRST_NAME, 
    CSR_LAST_NAME, 
    CSR_EMAIL, 
    CSR_PHONE, 
    CSR_CONTACT_LAST_UPDATE_BY, 
    CSR_CONTACT_CREATED_BY, 
    FQA_USER_ID, 
    FQA_FIRST_NAME, 
    FQA_LAST_NAME, 
    FQA_EMAIL, 
    FQA_PHONE, 
    FQA_CONTACT_LAST_UPDATE_BY, 
    FQA_CONTACT_CREATED_BY, 
    BUYER_USER_ID, 
    BUYER_FIRST_NAME, 
    BUYER_LAST_NAME, 
    BUYER_EMAIL, 
    BUYER_PHONE, 
    BUYER_CONTACT_LAST_UPDATE_BY, 
    BUYER_CONTACT_CREATED_BY, 
    FSE_USER_ID, 
    FSE_FIRST_NAME, 
    FSE_LAST_NAME, 
    FSE_EMAIL, 
    FSE_PHONE, 
    FSE_CONTACT_LAST_UPDATE_BY, 
    FSE_CONTACT_CREATED_BY,
    BIW_INS_DTTM, 
    BIW_UPD_DTTM, 
    BIW_BATCH_ID 
FROM 
    {{ref('MART_SALES_CUSTOMER') }}
),

MART_CORPORATION AS (
  SELECT 
    CORPORATION_KEY, 
    CORPORATION_CODE, 
    ERP_CUST_ACCOUNT_ID, 
    CORPORATION_CATEGORY_CODE, 
    CORPORATION_CATEGORY_DESCRIPTION, 
    ERP_STATUS_CODE, 
    HOME_REGION, 
    IS_MARKET_MAKER, 
    CLASS, 
    URL, 
    ACCOUNT_TYPE, 
    IS_CUSTOMER_ITEM_CONTROL_REQUIRED, 
    BARCODE_LABEL_CODE, 
    VENDOR_CODE, 
    COLLECTOR_NAME, 
    TAX_PRINTING_DESCRIPTION, 
    GROUPING_RULE_CODE, 
    HAS_CREDIT_CHECK, 
    HAS_CREDIT_HOLD, 
    CONTRACT_NAME, 
    GSM_USER_ID, 
    GSM_FIRST_NAME, 
    GSM_LAST_NAME, 
    GSM_EMAIL, 
    GSM_PHONE, 
    GSM_CONTACT_LAST_UPDATE_BY, 
    GSM_CONTACT_CREATED_BY, 
    GAM_USER_ID, 
    GAM_FIRST_NAME, 
    GAM_LAST_NAME, 
    GAM_EMAIL, 
    GAM_PHONE, 
    GAM_CONTACT_LAST_UPDATE_BY, 
    GAM_CONTACT_CREATED_BY 
  FROM 
    {{ref('MART_SALES_CORPORATION') }}  
),

MART_SALES_TERRITORY AS (
    SELECT 
    SALES_TERRITORY_KEY, 
    SALES_ORGANIZATION_CODE,
    SALES_ORGANIZATION_DESCRIPTION, 
    SALES_REP_FIRM_NAME, 
    SALES_OFFICE_CODE, 
    SALES_OFFICE_NAME, 
    SALES_AREA_NAME, 
    SALES_SUB_AREA_NAME, 
    SALES_REGION_CODE, 
    SALES_REGION_NAME
    from 
    {{ ref('MART_SALES_SALES_TERRITORY') }}
)

SELECT
    CUSTOMER.CUSTOMER_KEY,
    CUSTOMER.CUSTOMER_CODE,
    CUSTOMER.ERP_SITE_USE_ID,
    CUSTOMER.ERP_STATUS,
    CUSTOMER.CRM_CUSTOMER_OID,
    CUSTOMER.CRM_STATUS,
    CUSTOMER.CUSTOMER_NAME,
    CUSTOMER.CUSTOMER_TYPE_CODE,
    CUSTOMER.CUSTOMER_TYPE_DESCRIPTION,
    CUSTOMER.CUSTOMER_SOURCE,
    CUSTOMER.BUSINESS_CLASS_CODE,
    CUSTOMER.CORPORATION_CODE,
    CUSTOMER.CORPORATION_DESCRIPTION,
    CUSTOMER.END_CORPORATION_CODE,
    CUSTOMER.END_CORPORATION_DESCRIPTION,
    CUSTOMER.SALES_ORGANIZATION_CODE,
    CUSTOMER.END_USE_CODE,
    CUSTOMER.END_USE_DESCRIPTION,
    CUSTOMER.CURRENCY_CODE,
    CUSTOMER.ISO_CURRENCY_CODE,
    CUSTOMER.HAS_CREDIT_HOLD AS CUSTOMER_HAS_CREDIT_HOLD,
    CUSTOMER.HAS_SERVICE_HOLD,
    CUSTOMER.HAS_APPROVAL,
    CUSTOMER.ORDER_PROCESSING_REGION_CODE,
    CUSTOMER.CRD_SHIP_EARLY_DAYS_QUANTITY,
    CUSTOMER.HAS_CRD_PARTIAL,
    CUSTOMER.SHIP_VIA_CODE,
    CUSTOMER.HAS_SHIP_TO_CRD,
    CUSTOMER.SHIP_LATE_DAYS_QUANTITY,
    CUSTOMER.BILL_CUSTOMER_CODE,
    CUSTOMER.HANDLING_METHOD_CODE,
    CUSTOMER.HANDLING_METHOD_CODE_DESCRIPTION,
    CUSTOMER.IS_EDI_CUSTOMER,
    CUSTOMER.FINAL_DESTINATION_DESCRIPTION,
    CUSTOMER.BILL_COUNTRY_SOURCE_CODE,
    CUSTOMER.FOB_OPTION_CODE,
    CUSTOMER.PAYMENT_TERM_CODE,
    CUSTOMER.FINANCIAL_BANK_ID,
    CUSTOMER.TRANSIT_DAYS_QUANTITY,
    CUSTOMER.DELIVERY_TYPE_CODE,
    CUSTOMER.DATE_CODE_MAXIMUM_AGE_QUANTITY,
    CUSTOMER.IS_CPN_REQUIRED,
    CUSTOMER.VAT_TAX_CODE,
    CUSTOMER.MINIMUM_DOLLAR_VALUE_AMOUNT,
    CUSTOMER.IS_MINIMUM_DOLLAR_VALUE_VALID,
    -- Need to get inputs from Vandy or Dax
    CUSTOMER.CORPORATION_CATEGORY_CODE AS CUSTOMER_CATEGORY_CODE,
    CUSTOMER.CORPORATION_CATEGORY_DESCRIPTION AS CUSTOMER_CATEGORY_DESCRIPTION,
    CUSTOMER.CUSTOMER_ENTITY_CODE,
    CUSTOMER.FORECAST_TYPE_CODE,
    CUSTOMER.IS_FORECAST_CUSTOMER,
    CUSTOMER.FORECAST_CUSTOMER_STATUS_CODE,
    CUSTOMER.REPLENISHMENT_CODE,
    CUSTOMER.SERVICE_TYPE_CODE,
    CUSTOMER.CHANGE_ORDER_APROVAL_REQUIRED_CODE,
    CUSTOMER.UDC_GENERIC_PROG_DESCRIPTION,
    CUSTOMER.CREATE_BY_ID,
    CUSTOMER.CREATE_DTTM,
    CUSTOMER.LAST_UPDATE_BY_ID,
    CUSTOMER.LAST_UPDATE_DTTM,
    CUSTOMER.IS_DELETED,
    CUSTOMER.QUALITY_CODE,
    CUSTOMER.FISCAL_ACCOUNT_NUMBER,
    CUSTOMER.CREDIT_LIMIT_AMOUNT,
    CUSTOMER.DIVISION,
    CUSTOMER.SALES_STRUCTURE,
    CUSTOMER.MARKET_SEGMENT_CODE,
    CUSTOMER.IS_ASSEMBLY_LOCATION,
    CUSTOMER.OPERATING_UNIT,
    CUSTOMER.COF_CODE,
    CUSTOMER.COG_CODE,
    CUSTOMER.CUSTOMER_SHUT_DOWN_FROM_DATE,
    CUSTOMER.CUSTOMER_SHUT_DOWN_TO_DATE,
    CUSTOMER.FOB_OPTION_DESCRIPTION,
    CUSTOMER.TAX_CODE,
    CUSTOMER.ORACLE_ORDER_TYPE,
    CUSTOMER.ORACLE_PAYMENT_TERM,
    CUSTOMER.ORACLE_SITE_STATUS,
    CUSTOMER.ORACLE_SITE_NUMBER,
    CUSTOMER.ORACLE_SHIP_METHOD,
    CUSTOMER.FREE_TRADE_ZONE,
    CUSTOMER.COLLECTOR_NAME AS CUSTOMER_COLLECTOR_NAME,
    CUSTOMER.IS_SHUTDOWN,
    CUSTOMER.CSR_USER_ID,
    CUSTOMER.CSR_FIRST_NAME,
    CUSTOMER.CSR_LAST_NAME,
    CUSTOMER.CSR_EMAIL,
    CUSTOMER.CSR_PHONE,
    CUSTOMER.CSR_CONTACT_LAST_UPDATE_BY,
    CUSTOMER.CSR_CONTACT_CREATED_BY,
    CUSTOMER.FQA_USER_ID,
    CUSTOMER.FQA_FIRST_NAME,
    CUSTOMER.FQA_LAST_NAME,
    CUSTOMER.FQA_EMAIL,
    CUSTOMER.FQA_PHONE,
    CUSTOMER.FQA_CONTACT_LAST_UPDATE_BY,
    CUSTOMER.FQA_CONTACT_CREATED_BY,
    CUSTOMER.BUYER_USER_ID,
    CUSTOMER.BUYER_FIRST_NAME,
    CUSTOMER.BUYER_LAST_NAME,
    CUSTOMER.BUYER_EMAIL,
    CUSTOMER.BUYER_PHONE,
    CUSTOMER.BUYER_CONTACT_LAST_UPDATE_BY,
    CUSTOMER.BUYER_CONTACT_CREATED_BY,
    CUSTOMER.FSE_USER_ID,
    CUSTOMER.FSE_FIRST_NAME,
    CUSTOMER.FSE_LAST_NAME,
    CUSTOMER.FSE_EMAIL,
    CUSTOMER.FSE_PHONE,
    CUSTOMER.FSE_CONTACT_LAST_UPDATE_BY,
    CUSTOMER.FSE_CONTACT_CREATED_BY,
    CORPORATION.ERP_CUST_ACCOUNT_ID,
    CORPORATION.CORPORATION_CATEGORY_CODE,
    CORPORATION.CORPORATION_CATEGORY_DESCRIPTION,
    CORPORATION.ERP_STATUS_CODE,
    CORPORATION.HOME_REGION,
    CORPORATION.IS_MARKET_MAKER,
    CORPORATION.CLASS,
    CORPORATION.URL,
    CORPORATION.ACCOUNT_TYPE,
    CORPORATION.IS_CUSTOMER_ITEM_CONTROL_REQUIRED,
    CORPORATION.BARCODE_LABEL_CODE,
    CORPORATION.VENDOR_CODE,
    CORPORATION.COLLECTOR_NAME,
    CORPORATION.TAX_PRINTING_DESCRIPTION,
    CORPORATION.GROUPING_RULE_CODE,
    CORPORATION.HAS_CREDIT_CHECK,
    CORPORATION.HAS_CREDIT_HOLD AS HAS_CORPORATION_CREDIT_HOLD,
    CORPORATION.CONTRACT_NAME,
    CORPORATION.GSM_USER_ID,
    CORPORATION.GSM_FIRST_NAME,
    CORPORATION.GSM_LAST_NAME,
    CORPORATION.GSM_EMAIL,
    CORPORATION.GSM_PHONE,
    CORPORATION.GSM_CONTACT_LAST_UPDATE_BY,
    CORPORATION.GSM_CONTACT_CREATED_BY,
    CORPORATION.GAM_USER_ID,
    CORPORATION.GAM_FIRST_NAME,
    CORPORATION.GAM_LAST_NAME,
    CORPORATION.GAM_EMAIL,
    CORPORATION.GAM_PHONE,
    CORPORATION.GAM_CONTACT_LAST_UPDATE_BY,
    CORPORATION.GAM_CONTACT_CREATED_BY,
    SALES_TERRITORY.SALES_ORGANIZATION_DESCRIPTION,
    SALES_TERRITORY.SALES_REP_FIRM_NAME,
    SALES_TERRITORY.SALES_OFFICE_CODE,
    SALES_TERRITORY.SALES_OFFICE_NAME,
    SALES_TERRITORY.SALES_AREA_NAME,
    SALES_TERRITORY.SALES_SUB_AREA_NAME,
    SALES_TERRITORY.SALES_REGION_CODE,
    SALES_TERRITORY.SALES_REGION_NAME,
    CUSTOMER.BIW_INS_DTTM, 
    CUSTOMER.BIW_UPD_DTTM, 
    CUSTOMER.BIW_BATCH_ID 
FROM MART_CUSTOMER AS CUSTOMER
LEFT JOIN MART_CORPORATION AS CORPORATION
    ON CUSTOMER.CORPORATION_CODE = CORPORATION.CORPORATION_CODE 
LEFT JOIN MART_SALES_TERRITORY AS SALES_TERRITORY
    ON  CUSTOMER.SALES_ORGANIZATION_CODE = SALES_TERRITORY.SALES_ORGANIZATION_CODE 
