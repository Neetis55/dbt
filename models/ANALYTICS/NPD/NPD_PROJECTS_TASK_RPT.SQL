{{ 
config
(
  description = 'NPD LANDING PAGE REPORT VIEW ', 
  materialized = 'view', 
  schema = 'NPD', 
  tags = ['MART_NPD'],
  alias = 'PROJECTS_TASK_RPT'
) 
}}

SELECT 
    MSPROJECT_TASK_KEY,
    SNAPSHOT_WEEK_KEY,
    PROJECT_NUMBER,
    PROJECT_ID,
    PROJECT_NAME,
    PROJECT_OWNER,
    PROJECT_INTERNAL_URL,
    TASK_ID,    
    TASK_NAME,
    TASK_OWNER,
    TASK_START_DATE,
    TASK_FINISH_DATE,
    TASK_ACTUAL_START_DATE,
    TASK_ACTUAL_FINISH_DATE,
    TASK_LATE_START,
    TASK_LATE_FINISH,
    TASK_PERCENT_COMPLETED,
    IS_PAST_DUE,
    IS_DUE_IN_NEXT_7DAYS,
    TASK_CREATED_DATE,
    BIW_INS_DTTM ,
    BIW_UPD_DTTM ,
    BIW_BATCH_ID,
    BIW_MD5_KEY
FROM 
    {{ref ('MART_NPD_PROJECTS_TASK_RPT')}}
WHERE SNAPSHOT_WEEK_KEY > (SELECT (SUBSTRING(MAX(SNAPSHOT_WEEK_KEY)-200,1,4)||'00')::NUMBER FROM {{ref ('MART_NPD_PROJECTS_TASK_RPT')}})