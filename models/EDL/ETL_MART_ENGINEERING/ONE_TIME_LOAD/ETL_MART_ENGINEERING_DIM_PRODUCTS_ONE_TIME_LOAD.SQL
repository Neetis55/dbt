--dbt run --select ETL_MART_ENGINEERING_DIM_PRODUCTS_ONE_TIME_LOAD
--dbt run --full-refresh --select ETL_MART_ENGINEERING_DIM_PRODUCTS_ONE_TIME_LOAD
{################# EDW Job Template Variables #################}
{%-set v_pk_list = ['PART_KEY']-%}
{% if is_incremental() %}
{%-set v_house_keeping_column = ['BIW_INS_DTTM','BIW_UPD_DTTM','BIW_BATCH_ID','BIW_MD5_KEY']-%}
{%-set v_all_column_list =  edw_get_column_list( this ) -%}
{%-set v_update_column_list =  edw_get_quoted_column_list( this ,v_pk_list|list + ['BIW_INS_DTTM']|list) -%}
{%-set v_md5_column_list =  edw_get_md5_column_list( this ,v_pk_list|list+ v_house_keeping_column|list ) -%}
--DBT Variable
--SELECT {{v_all_column_list}}
--SELECT {{v_update_column_list}}
--SELECT {{v_md5_column_list}}
{% endif %}

{################# Batch control insert and update SQL #################}
{%- set v_dbt_job_name = 'DBT_ETL_MART_ENGINEERING_DIM_PRODUCTS_ONE_TIME_LOAD'-%}
-- Step 1 Batch process info
{%- set v_watermark = edw_batch_control(v_dbt_job_name,config.get('schema'),config.get('alias') ,config.get('tags'),config.get('materialized') ) -%}
{%- set V_LWM = v_watermark[0] -%}
{%- set V_HWM = v_watermark[1] -%}
{%- set V_START_DTTM = v_watermark[2] -%}
{%- set V_BIW_BATCH_ID = v_watermark[3] -%}
{%- set v_sql_upd_success_batch = "CALL UTILITY.EDW_BATCH_SUCCESS_PROC('"~v_dbt_job_name~"')" -%}

{{
    config(
         description = 'loading dim_products one time to part'
        ,transient=true
        ,materialized='view'
        ,schema ='ETL_MART_ENGINEERING'
        ,alias='DIM_PRODUCTS_ONE_TIME_LOAD'
        ,unique_key= v_pk_list
        ,tags ='MART_ENGINEERING'
        ,post_hook= [v_sql_upd_success_batch]
        )
}}

WITH STG_XXON_FS_BU_RULE AS
(
    SELECT 
        BU_CD,
        BUSINESS_GROUP,
        REPORTING_UNIT
    FROM {{source('STG_EBS_APPS','XXON_FS_BU_RULE')}}
    QUALIFY( ROW_NUMBER() OVER (PARTITION BY BU_CD ORDER BY BIW_UPD_DTTM DESC)=1) 
)
SELECT
	PRODUCT_ID AS PART_ID,
	--ONE_PRODUCT_AK AS PART_KEY,
	md5(PRODUCT_ID) AS PART_KEY,
	AEC_QUAL AS AEC_QUALIFIED_CODE,
	AGILE_ASSMBLY_SITE_CD AS AGILE_ASSEMBLY_SITE_CODE,
	AGILE_TST_SITE_CD AS AGILE_TEST_SITE_CODE,
	NVL(ANCHOR_STAR_PROD_FLG::string,' ') AS ANCHOR_STAR_PRODUCT_CODE,
	APS_ASSMBLY_SITE_CD AS APS_ASSEMBLY_SITE_CODE,
	APS_BUILD_CATEGORY_CD AS APS_BUILD_CATEGORY_CODE,
	coalesce(APS_RELEVANT_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_APS_RELEVANT,
	APS_TST_SITE_CD AS APS_TEST_SITE_CODE,
	ASSMBLY_RATIO_NUM AS ASSEMBLY_RATIO_NUMBER,
	AVG_USAGE_NUM AS AVERAGE_USAGE_NUMBER,
	BSNSS_UNIT_CD AS BUSINESS_UNIT_CODE,
	BSNSS_UNIT_DESC AS BUSINESS_UNIT_DESCRIPTION,
	coalesce(BURN_IN_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_BURN_IN,
	NVL(MAKE_BUY_CD,' ') AS BUY_SELL_CODE,
	BU_MGR_ID AS BU_MANAGER_ID,
	BU_MGR_NM AS BU_MANAGER_NAME,
	CAPACITY_GROUP_CD AS CAPACITY_GROUP_CODE,
	CAPC_CONSTR_COLOR AS CAPC_CONSTR_COLOR,
	NULL AS CAPC_CONSTR_COLOR_CALCED,
	NULL AS CAPC_CONSTR_COLOR_OVRD,
	NULL AS CAPC_CONSTR_COLOR_OVRD_RSN,
	NULL AS CAPC_CONSTR_COLOR_OVRD_UID,
	NULL AS CAPC_CONSTR_PRIM_CONSTR_RG,
	CASE_OUTLINE_CD AS CASE_OUTLINE_CODE,
	CASE_OUTLINE_ID AS CASE_OUTLINE_ID,
	COMMODITY_CD AS COMMODITY_CODE,
	'TDB' AS COMPONENT_COUNT,
	coalesce(CONTAIN_ENCRYPT_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_CONTAIN_ENCRYPT,
	CORE_PART_NO_CONFIG_ID AS CORE_PART_NO_CONFIG_ID,
	CREATE_BY AS CREATE_BY,
	CREATED_DATE::DATE AS CREATE_DATE,
	coalesce(CUSTOMER_CONSIGN_TO_ON_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_CUSTOMER_CONSIGN_TO_ON,
	coalesce(CUSTOM_ELEC_TEST_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_CUSTOM_ELEC_TEST,
	coalesce(CUSTOM_MARK_ONLY_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_CUSTOM_MARK_ONLY,
	coalesce(CUSTOM_PART_ID_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_CUSTOM_PART_ID,
	CASE WHEN CUST_SPEC_FLAG=1 THEN 'Y' ELSE 'N' END AS CUST_SPEC_CONTROLLED_CODE,
	DCE_CYCLE_TM_DAYS AS DCE_CYCLE_TIME_DAYS,
	DEFLT_APS_STAGE_CD AS DEFLT_APS_STAGE_CD,
	DEFLT_FE_BE_CD AS DEFLT_FE_BE_CD,
	DESIGN_TYPE_DESC AS DESIGN_TYPE_DESC,
	DIE_DESIGN_CONFIG_ID AS DIE_DESIGN_CONFIG_ID,
	'TBD' AS DISTINCT_COMPONENT_COUNT,
	DIVISION_CD AS DIVISION_CODE,
	DIVISION_DESC AS DIVISION_DESCRIPTION,
	DOCUMENT_ISSUE AS DOCUMENT_ISSUE,
	ECAT_CD AS ECAT_CODE,
	ECCN_CD AS ECCN_CODE,
	EFF_DT AS EFFECTIVE_DATE,
	ENGG_CHNG_ORDER_ID AS ENGG_CHNG_ORDER_ID,
	coalesce(ENG_PART_FLAG::BOOLEAN,'FALSE')::BOOLEAN AS IS_ENG_PART,
	ENG_PKG_CD AS ENG_PKG_CODE,
	ENG_PKG_FAM_DESC AS ENG_PKG_FAM_DESC,
	ENG_PKG_TYPE_DESC AS ENG_PKG_TYPE_DESC,
	ENG_PKG_VAR_ID AS ENG_PKG_VAR_ID,
	ERP_RESOURCE_ASY_CD AS ERP_RESOURCE_ASY_CODE,
	ERP_RESOURCE_ASY_DESC AS ERP_RESOURCE_ASY_DESCRIPTION,
	ERP_RESOURCE_BSP_CD AS ERP_RESOURCE_BSP_CODE,
	ERP_RESOURCE_FAB_CD AS ERP_RESOURCE_FAB_CODE,
	ERP_RESOURCE_FSP_CD AS ERP_RESOURCE_FSP_CODE,
	ERP_RESOURCE_MEF_CD AS ERP_RESOURCE_MEF_CODE,
	ERP_RESOURCE_SWF_CD AS ERP_RESOURCE_SWF_CODE,
	ERP_RESOURCE_TST_CD AS ERP_RESOURCE_TST_CODE,
	EXPERT_DATA_SRC_NM AS EXPERT_DATA_SOURCE_NAME,
	EXPERT_EMAIL AS EXPERT_EMAIL,
	EXPERT_NM AS EXPERT_NAME,
	EXPERT_USER_ID AS EXPERT_USER_ID,
	FAMILY_LEAD_TM_DAYS AS FAMILY_LEAD_TIME_DAYS,
	FLOW_CD AS FLOW_CODE,
	GLOBAL_PART_ID AS GLOBAL_PART_ID,
	GROUP_CD AS GROUP_CODE,
	GROUP_DESC AS GROUP_DESCRIPTION,
	coalesce(HALIDE_FREE_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_HALIDE_FREE,
	NULL AS HTS_EU_8_CODE,
	HTS_EU_CD AS HTS_EU_CODE,
	HTS_EU_CD_DESC AS HTS_EU_CODE_DESCRIPTION,
	HTS_US_CD AS HTS_US_CODE,
	HTS_US_CD_DESC AS HTS_US_CODE_DESCRIPTION,
	PLANNING_BUILD_CATEGORY AS IO_CATEGORY,
	IO_OVERRIDE_CATEGORY AS IO_OVERRIDE_CATEGORY,
	IO_PART_CLASS AS IO_PART_CLASS,
	coalesce(ITAR_FLAG::BOOLEAN,'FALSE')::BOOLEAN AS IS_ITAR,
	'N'::BOOLEAN AS IS_LABEL_SYMBOL_2LI,
	NULL AS LABEL_SYMBOL_ECAT_CODE,
	'N'::BOOLEAN AS IS_LABEL_SYMBOL_ECAT,
	'N'::BOOLEAN AS IS_LABEL_SYMBOL_HALIDE_FREE,
	'N'::BOOLEAN AS IS_LABEL_SYMBOL_PBFREE_2LI,
	'N'::BOOLEAN AS IS_LABEL_SYMBOL_ROHS_CHINA,
	NULL AS LABEL_SYMBOL_ROHS_CHINA_VALUE,
	'N'::BOOLEAN AS IS_LABEL_SYMBOL_ROHS_EU,
	'N'::BOOLEAN AS IS_LABEL_SYMBOL_RU,
	LAST_CHG_DT AS LAST_CHANGE_DATE,
	LAST_CHG_USER_ID AS LAST_CHANGE_USER_ID,
	LAST_ORDER_DT::DATE AS LAST_ORDER_DATE,
	LAST_SHIP_DT AS LAST_SHIP_DATE,
	EXEMPTIONS AS LEADED_DIE_ATTACH_CODE,
	LEGACY_COMPANY_NM AS LEGACY_COMPANY_NAME,
	LEGACY_PART_ID AS LEGACY_PART_ID,
	LIFECYCLE_PHASE_DESC AS LIFECYCLE_PHASE_DESCRIPTION,
	MARKET_PN AS MARKET_PN,
	coalesce(MARKET_PN_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_MARKET_PN,
	0::NUMBER AS MAX_LINE_QUANTITY,
	MBOI_ASSMBLY_SITE_CD AS MBOI_ASSEMBLY_SITE_CODE,
	MBOI_TST_SITE_CD AS MBOI_TEST_SITE_CODE,
	MFG_PART_ID AS MFG_PART_ID,
	CASE WHEN MILITARY_COMPLIANCE_FLG = 1 THEN 'Y' ELSE 'N' END AS MILITARY_COMPLIANCE_CODE,
	MKTG_PART_LIFECYCLE_DESC AS MARKET_PART_LIFECYCLE_DESCRIPTION,
	0::NUMBER AS MARKET_LEADTIME_WEEKS,
	MKT_SEG_SUBSEG_EUC_PRI_DESC AS MKT_SEG_SUBSEG_EUC_PRI_DESC,
	MOQ_QTY AS MOQ_QUANTITY,
	coalesce(MPP_FLAG::BOOLEAN,'FALSE')::BOOLEAN AS IS_MPP,
	MPQ_CONTAINER_CD AS MPQ_PRI_CONTAINER_CODE,
	MPQ_QTY AS MPQ_PRI_CONTAINER_QUANTITY,
	MSL_TEMPERATURE AS MSL_TEMPERATURE,
	MSL AS MSL_VALUE,
	coalesce(NCNR_FLAG::BOOLEAN,'FALSE')::BOOLEAN AS IS_NCNR,
	'1/1/1900'::DATE AS NEW_PART_DEFINITION_DATE,
	'1/1/1900'::DATE AS NEW_PART_EXP_DATE,
	OPERTNL_CD AS OPERTNL_CODE,
	OPERTNL_DESC AS OPERTNL_DESC,
	coalesce(OPN_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_OPN,
	OVERRIDE_LEAD_TM_DAYS AS OVERRIDE_LEAD_TIME_DAYS,
	PACKAGE_GROUP AS PACKAGE_GROUP_CODE,
	PACKING_CONFIG_ID AS PACKING_CONFIG_ID,
	NULL AS PAL1_CODE,
	PAL2_CD AS PAL2_CODE,
	TRIM(PAL2_DESC) AS PAL2_DESCRIPTION,
	PAL3_CD AS PAL3_CODE,
	TRIM(PAL3_DESC) AS PAL3_DESCRIPTION,
	PAL4_CD AS PAL4_CODE,
	TRIM(PAL4_DESC) AS PAL4_DESCRIPTION,
	PART_AREA_CD AS PART_AREA_CODE,
	PART_AVAIL_STATUS_CD AS PART_AVAILABILITY_STATUS_CODE,
	PROD_CLASS_CD AS PART_CLASS_CODE,
	PROD_CLASS_DESC AS PART_CLASS_DESCRIPTION,
	PRODLINE_COMPTYPE AS PART_COMP_TYPE_CODE,
	PRODUCT_DESC AS PART_DESCRIPTION,
	PROD_LINE_ID AS PART_LINE_ID,
	PART_OID_AK AS PART_OID_AK_ID,
	PART_OWNER_DESC AS PART_OWNER_DESCRIPTION,
	PART_OWNER_NM AS PART_OWNER_NAME,
	PART_PROGRAM_CD AS PART_PROGRAM_CODE,
	QUAL_TYPE,QUAL_TYPE_DESC AS PART_QUALITY_TARGET_MARKET_DESCRIPTION,
	RELEASE_DATE::DATE AS PART_RELEASE_PRODUCTION_DATE,
	QUAL_STATUS AS PART_RELEASE_STATUS_CODE,
	QUAL_STATUS_DESC AS PART_RELEASE_STATUS_DESCRIPTION,
	NULL::DATE AS PART_REL_FCST_DATE,
	PART_SOURCE AS PART_SOURCE,
	PART_SPEC_ID AS PART_SPEC_ID,
	PART_SUB_AREA_CD AS PART_SUB_AREA_CODE,
	PART_SUB_TYPE_CD AS PART_SUB_TYPE_CD,
	PART_TYPE_DESC AS PART_TRANS_STATUS_CODE,
	PARTSTATUS_DESC AS PART_TRANS_STATUS_DESCRIPTION,
	PART_TYPE_DESC AS PART_TYPE_DESCRIPTION,
	coalesce(LEADFREE_FLAG::BOOLEAN,'FALSE')::BOOLEAN AS IS_PB_FREE_LEADS,
	NULL AS PB_FREE_PART_DESCRIPTION,
	NULL AS PB_FREE_PART_EXEMPT,
	'N'::BOOLEAN AS IS_PB_FREE_PART,
	STD_CONVERS_RATE AS PDPW_VALUE,
	PLANNING_DIR_ID AS PLANNING_DIRECTOR_ID,
	PLANNING_DIR_NM AS PLANNING_DIRECTOR_NAME,
	PLANNING_SYSTEM_LEAD_TM_DAYS AS PLANNING_SYSTEM_LEAD_TIME_DAYS,
	POINT_LEAD_TM_DAYS AS POINT_LEAD_TIME_DAYS,
	POQ_CONTAINER_CD AS POQ_CONTAINER_CODE,
	POQ_QTY AS POQ_QUANTITY,
	PPAP_CD AS PPAP_CAPABLE_CODE,
	PREDOMINANT_OPN_PART_ID AS PREDOMINANT_OPN_PART_ID,
	coalesce(PRICE_BOOK_FLAG::BOOLEAN,'FALSE')::BOOLEAN AS IS_PRICE_BOOK,
	PROJECT_NUMBER_CD AS PROJECT_NUMBER_CD,
	QUALITY_LVL_CD AS QUALITY_LVL_CODE,
	QUALITY_LVL_TGT_MRKT_DESC AS QUALITY_LVL_TARGET_MARKET_DESCRIPTION,
	CASE WHEN ROHS_CHINA_FLG=1 THEN 'Y' ELSE 'N' END AS ROHS_CHINA_CODE,
	ROHS_EU_EXEMPTION_CD AS ROHS_EU_EXEMPTION_CODE,
	CASE WHEN ROHS_EU_FLG=1 THEN 'Y' ELSE 'N' END AS ROHS_EU_CODE,
	CASE WHEN SAFE_LAUNCH_FLG=1 THEN 'Y' ELSE 'N' END AS SAFE_LAUNCH_CODE,
	CASE WHEN SAMPLE_ALLOW_FLG=1 THEN 'Y' ELSE 'N' END AS SAMPLE_ALLOW_CODE,
	SBU_CD AS SBU_CODE,
	SBU_SHORT_DESC AS SBU_SHORT_DESCRIPTION,
	coalesce(SOLE_SOURCE_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_SOLE_SOURCE,
	SOLUTION_SELLING_TYPE AS SOLUTION_SELLING_TYPE,
	SOQ_CONTAINER_CD AS SOQ_CONTAINER_CODE,
	coalesce(SPEC_CNTRL_BOM_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_SPEC_CNTRL_BOM,
	coalesce(STEP_PRICE_FLAG::BOOLEAN,'FALSE')::BOOLEAN AS IS_STEP_PRICE,
	NULL AS SUBJECT_EXPORT_ADMIN_REG,
    CASE WHEN SUPPLY_CHN_PLNG_FLG=1 THEN 'YES' ELSE 'NO' END AS SUPPLY_CHN_PLNG_CODE,
	coalesce(CASE WHEN TAPE_REEL_FLAG='Y' THEN 'Y' ELSE 'N' END::BOOLEAN,'FALSE')::BOOLEAN AS IS_TAPE_REEL,
	'TBD' AS TOTAL_COMPONENT_COUNT,
	TREND_LEAD_TM_DAYS AS TREND_LEAD_TIME_DAYS,
	coalesce(UL_LISTED_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_UL_LISTED,
	UOM_OPERATIONS_CD AS UOM_OPERATIONS_CODE,
	coalesce(VALUED_PART_FLG::BOOLEAN,'FALSE')::BOOLEAN AS IS_VALUED_PART,
	WAFER_BACKSIDE_VAR_ID AS WAFER_BACKSIDE_VAR_ID,
	WAFER_FRONTSIDE_VARIANT_ID AS WAFER_FRONTSIDE_VARIANT_ID,
	WAFER_SIZE_VAL AS WAFER_SIZE_VALUE,
	WAFER_TECH_FAM_ID AS WAFER_TECH_FAM_ID,
	WAFER_TECH_TYPE_ID AS WAFER_TECH_TYPE_ID,
	WAFER_TECH_VARIANT_ID AS WAFER_TECH_VARIANT_ID,
	WFA_SITE_CD AS WFA_SITE_CODE,
	WPR_SITE_CD AS WPR_SITE_CODE,
	WSTS_CD AS WSTS_CD,
	EXEMPTIONS AS EXEMPTIONS,
	SOQ_QTY AS SOQ_QUANTITY,
	RELEASE_DATE AS RELEASE_DATE,
	coalesce(ROHS_FLAG::BOOLEAN,'FALSE')::BOOLEAN AS IS_ROHS,
	PART_STATUS_GROUP AS PART_STATUS_GROUP,
	NULL AS PART_QUALITY_TARGET_MARKET_TYPE,
	NPD_DATE::DATE AS NPD_DATE,
	PACKAGE_CD_DESC AS PACKAGE_CODE_DESCRIPTION,
	'1/1/1900'::DATE AS PART_ADD_TIMESTAMP,
	coalesce(On_Target_Flag::BOOLEAN,'FALSE')::BOOLEAN AS IS_ON_TARGET,
	BU_RULE.BUSINESS_GROUP AS BUSINESS_GROUP,
    BU_RULE.REPORTING_UNIT,
    NVL(FSP_DATE,DATE('01-01-1900', 'MM-DD-YYYY') ) AS FSP_DATE,
    --'1/1/1900'::DATE AS FSP_DATE,
    md5(object_construct ('col1',AEC_QUALIFIED_CODE::string, 'col2',AGILE_ASSEMBLY_SITE_CODE::string,
    'col3',AGILE_TEST_SITE_CODE::string, 'col4',ANCHOR_STAR_PRODUCT_CODE::string, 'col5',APS_ASSEMBLY_SITE_CODE::string,
    'col6',APS_BUILD_CATEGORY_CODE::string, 'col7',IS_APS_RELEVANT::string, 'col8',APS_TEST_SITE_CODE::string, 'col9',ASSEMBLY_RATIO_NUMBER::string,
    'col10',AVERAGE_USAGE_NUMBER::string, 'col11',BUSINESS_UNIT_CODE::string, 'col12',BUSINESS_UNIT_DESCRIPTION::string, 'col13',IS_BURN_IN::string,
    'col14',BUY_SELL_CODE::string, 'col15',BU_MANAGER_ID::string, 'col16',BU_MANAGER_NAME::string, 'col17',CAPACITY_GROUP_CODE::string,
    'col18',CAPC_CONSTR_COLOR::string, 'col19',CAPC_CONSTR_COLOR_CALCED::string, 'col20',CAPC_CONSTR_COLOR_OVRD::string,
    'col21',CAPC_CONSTR_COLOR_OVRD_RSN::string, 'col22',CAPC_CONSTR_COLOR_OVRD_UID::string, 'col23',CAPC_CONSTR_PRIM_CONSTR_RG::string,
    'col24',CASE_OUTLINE_CODE::string, 'col25',CASE_OUTLINE_ID::string, 'col26',COMMODITY_CODE::string, 'col27',COMPONENT_COUNT::string,
    'col28',IS_CONTAIN_ENCRYPT::string, 'col29',CORE_PART_NO_CONFIG_ID::string, 'col30',CREATE_BY::string, 'col31',CREATE_DATE::string,
    'col32',IS_CUSTOMER_CONSIGN_TO_ON::string, 'col33',IS_CUSTOM_ELEC_TEST::string, 'col34',IS_CUSTOM_MARK_ONLY::string, 'col35',IS_CUSTOM_PART_ID::string,
    'col36',CUST_SPEC_CONTROLLED_CODE::string, 'col37',DCE_CYCLE_TIME_DAYS::string, 'col38',DEFLT_APS_STAGE_CD::string, 'col39',DEFLT_FE_BE_CD::string,
    'col40',DESIGN_TYPE_DESC::string, 'col41',DIE_DESIGN_CONFIG_ID::string, 'col42',DISTINCT_COMPONENT_COUNT::string, 'col43',DIVISION_CODE::string,
    'col44',DIVISION_DESCRIPTION::string, 'col45',DOCUMENT_ISSUE::string, 'col46',ECAT_CODE::string, 'col47',ECCN_CODE::string, 'col48',EFFECTIVE_DATE::string,
    'col49',ENGG_CHNG_ORDER_ID::string, 'col50',IS_ENG_PART::string, 'col51',ENG_PKG_CODE::string, 'col52',ENG_PKG_FAM_DESC::string,
    'col53',ENG_PKG_TYPE_DESC::string, 'col54',ENG_PKG_VAR_ID::string, 'col55',ERP_RESOURCE_ASY_CODE::string, 'col56',ERP_RESOURCE_ASY_DESCRIPTION::string,
    'col57',ERP_RESOURCE_BSP_CODE::string, 'col58',ERP_RESOURCE_FAB_CODE::string, 'col59',ERP_RESOURCE_FSP_CODE::string, 'col60',ERP_RESOURCE_MEF_CODE::string,
    'col61',ERP_RESOURCE_SWF_CODE::string, 'col62',ERP_RESOURCE_TST_CODE::string, 'col63',EXPERT_DATA_SOURCE_NAME::string, 'col64',EXPERT_EMAIL::string,
    'col65',EXPERT_NAME::string, 'col66',EXPERT_USER_ID::string, 'col67',FAMILY_LEAD_TIME_DAYS::string, 'col68',FLOW_CODE::string,
    'col69',GLOBAL_PART_ID::string, 'col70',GROUP_CODE::string, 'col71',GROUP_DESCRIPTION::string, 'col72',IS_HALIDE_FREE::string,
    'col73',HTS_EU_8_CODE::string, 'col74',HTS_EU_CODE::string, 'col75',HTS_EU_CODE_DESCRIPTION::string, 'col76',HTS_US_CODE::string,
    'col77',HTS_US_CODE_DESCRIPTION::string, 'col78',IO_CATEGORY::string, 'col79',IO_OVERRIDE_CATEGORY::string, 'col80',IO_PART_CLASS::string,
    'col81',IS_ITAR::string, 'col82',IS_LABEL_SYMBOL_2LI::string, 'col83',LABEL_SYMBOL_ECAT_CODE::string, 'col84',IS_LABEL_SYMBOL_ECAT::string,
    'col85',IS_LABEL_SYMBOL_HALIDE_FREE::string, 'col86',IS_LABEL_SYMBOL_PBFREE_2LI::string, 'col87',IS_LABEL_SYMBOL_ROHS_CHINA::string,
    'col88',LABEL_SYMBOL_ROHS_CHINA_VALUE::string, 'col89',IS_LABEL_SYMBOL_ROHS_EU::string, 'col90',IS_LABEL_SYMBOL_RU::string, 'col91',LAST_CHANGE_DATE::string,
    'col92',LAST_CHANGE_USER_ID::string, 'col93',LAST_ORDER_DATE::string, 'col94',LAST_SHIP_DATE::string, 'col95',LEADED_DIE_ATTACH_CODE::string,
    'col96',LEGACY_COMPANY_NAME::string, 'col97',LEGACY_PART_ID::string, 'col98',LIFECYCLE_PHASE_DESCRIPTION::string, 'col99',MARKET_PN::string,
    'col100',IS_MARKET_PN::string, 'col101',MAX_LINE_QUANTITY::string, 'col102',MBOI_ASSEMBLY_SITE_CODE::string, 'col103',MBOI_TEST_SITE_CODE::string,
    'col104',MFG_PART_ID::string, 'col105',MILITARY_COMPLIANCE_CODE::string, 'col106',MARKET_PART_LIFECYCLE_DESCRIPTION::string,
    'col107',MARKET_LEADTIME_WEEKS::string, 'col108',MKT_SEG_SUBSEG_EUC_PRI_DESC::string, 'col109',MOQ_QUANTITY::string, 'col110',IS_MPP::string,
    'col111',MPQ_PRI_CONTAINER_CODE::string, 'col112',MPQ_PRI_CONTAINER_QUANTITY::string, 'col113',MSL_TEMPERATURE::string, 'col114',MSL_VALUE::string,
    'col115',IS_NCNR::string, 'col116',NEW_PART_DEFINITION_DATE::string, 'col117',NEW_PART_EXP_DATE::string, 'col118',OPERTNL_CODE::string,
    'col119',OPERTNL_DESC::string, 'col120',IS_OPN::string, 'col121',OVERRIDE_LEAD_TIME_DAYS::string, 'col122',PACKAGE_GROUP_CODE::string,
    'col123',PACKING_CONFIG_ID::string, 'col124',PAL1_CODE::string, 'col125',PAL2_CODE::string, 'col126',PAL2_DESCRIPTION::string, 'col127',PAL3_CODE::string,
    'col128',PAL3_DESCRIPTION::string, 'col129',PAL4_CODE::string, 'col130',PAL4_DESCRIPTION::string, 'col131',PART_AREA_CODE::string,
    'col132',PART_AVAILABILITY_STATUS_CODE::string, 'col133',PART_CLASS_CODE::string, 'col134',PART_CLASS_DESCRIPTION::string, 'col135',PART_COMP_TYPE_CODE::string,
    'col136',PART_DESCRIPTION::string, 'col137',PART_ID::string, 'col138',PART_LINE_ID::string, 'col139',PART_OID_AK_ID::string,
    'col140',PART_OWNER_DESCRIPTION::string, 'col141',PART_OWNER_NAME::string, 'col142',PART_PROGRAM_CODE::string,
    'col143',PART_QUALITY_TARGET_MARKET_DESCRIPTION::string, 'col144',PART_RELEASE_PRODUCTION_DATE::string, 'col145',PART_RELEASE_STATUS_CODE::string,
    'col146',PART_RELEASE_STATUS_DESCRIPTION::string, 'col147',PART_REL_FCST_DATE::string, 'col148',PART_SOURCE::string, 'col149',PART_SPEC_ID::string,
    'col150',PART_SUB_AREA_CODE::string, 'col151',PART_SUB_TYPE_CD::string, 'col152',PART_TRANS_STATUS_CODE::string,
    'col153',PART_TRANS_STATUS_DESCRIPTION::string, 'col154',PART_TYPE_DESCRIPTION::string, 'col155',IS_PB_FREE_LEADS::string, 'col156',PB_FREE_PART_DESCRIPTION::string,
    'col157',PB_FREE_PART_EXEMPT::string, 'col158',IS_PB_FREE_PART::string, 'col159',PDPW_VALUE::string, 'col160',PLANNING_DIRECTOR_ID::string,
    'col161',PLANNING_DIRECTOR_NAME::string, 'col162',PLANNING_SYSTEM_LEAD_TIME_DAYS::string, 'col163',POINT_LEAD_TIME_DAYS::string,
    'col164',POQ_CONTAINER_CODE::string, 'col165',POQ_QUANTITY::string, 'col166',PPAP_CAPABLE_CODE::string, 'col167',PREDOMINANT_OPN_PART_ID::string,
    'col168',IS_PRICE_BOOK::string, 'col169',PROJECT_NUMBER_CD::string, 'col170',QUALITY_LVL_CODE::string,
    'col171',QUALITY_LVL_TARGET_MARKET_DESCRIPTION::string, 'col172',ROHS_CHINA_CODE::string, 'col173',ROHS_EU_EXEMPTION_CODE::string, 'col174',ROHS_EU_CODE::string,
    'col175',SAFE_LAUNCH_CODE::string, 'col176',SAMPLE_ALLOW_CODE::string, 'col177',SBU_CODE::string, 'col178',SBU_SHORT_DESCRIPTION::string,
    'col179',IS_SOLE_SOURCE::string, 'col180',SOLUTION_SELLING_TYPE::string, 'col181',SOQ_CONTAINER_CODE::string, 'col182',IS_SPEC_CNTRL_BOM::string,
    'col183',IS_STEP_PRICE::string, 'col184',SUBJECT_EXPORT_ADMIN_REG::string, 'col185',SUPPLY_CHN_PLNG_CODE::string, 'col186',IS_TAPE_REEL::string,
    'col187',TOTAL_COMPONENT_COUNT::string, 'col188',TREND_LEAD_TIME_DAYS::string, 'col189',IS_UL_LISTED::string, 'col190',UOM_OPERATIONS_CODE::string,
    'col191',IS_VALUED_PART::string, 'col192',WAFER_BACKSIDE_VAR_ID::string, 'col193',WAFER_FRONTSIDE_VARIANT_ID::string,
    'col194',WAFER_SIZE_VALUE::string, 'col195',WAFER_TECH_FAM_ID::string, 'col196',WAFER_TECH_TYPE_ID::string, 'col197',WAFER_TECH_VARIANT_ID::string,
    'col198',WFA_SITE_CODE::string, 'col199',WPR_SITE_CODE::string, 'col200',WSTS_CD::string, 'col201',EXEMPTIONS::string, 'col202',SOQ_QUANTITY::string,
    'col203',RELEASE_DATE::string, 'col204',IS_ROHS::string, 'col205',PART_STATUS_GROUP::string, 'col206',PART_QUALITY_TARGET_MARKET_TYPE::string,
    'col207',NPD_DATE::string, 'col208',PACKAGE_CODE_DESCRIPTION::string, 'col209',PART_ADD_TIMESTAMP::string, 'col210',IS_ON_TARGET::string,
    'col211',BUSINESS_GROUP::string, 'col212',REPORTING_UNIT::string,'col213',FSP_DATE::string)::string ) as BIW_MD5_KEY
FROM {{ source('STG_SDM_PRESENTATION', 'DIM_PRODUCTS') }} HIST
LEFT OUTER JOIN  STG_XXON_FS_BU_RULE BU_RULE 
    ON HIST.PAL3_CD= BU_RULE.BU_CD 
QUALIFY( ROW_NUMBER() OVER (PARTITION BY PRODUCT_ID ORDER BY BIW_UPD_DTTM DESC) =1)

